# Battle é¡¹ç›®éƒ¨ç½²è¯´æ˜

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆç‰¹ç‚¹

âœ… **æœ¬åœ°æ„å»º** - åç«¯ Docker é•œåƒå’Œå‰ç«¯éƒ½åœ¨æœ¬åœ°æ„å»ºå¥½  
âœ… **åªä¼ äº§ç‰©** - ä¸ä¼ æºç ï¼Œåªä¼ æ„å»ºå¥½çš„é•œåƒå’Œé™æ€æ–‡ä»¶  
âœ… **å¿«é€Ÿéƒ¨ç½²** - æœåŠ¡å™¨ç«¯åªéœ€åŠ è½½å’Œå¯åŠ¨ï¼Œæ— éœ€ç¼–è¯‘  
âœ… **ç¯å¢ƒä¸€è‡´** - æœ¬åœ°æ„å»ºç¯å¢ƒå¯æ§ï¼Œé¿å…æœåŠ¡å™¨ç¼–è¯‘é—®é¢˜

---

## ğŸ“‹ ä¸¤ç§éƒ¨ç½²æ–¹å¼

### æ–¹å¼ 1ï¼šåç«¯æœåŠ¡å™¨ + å‰ç«¯ Vercelï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼šå‰ç«¯æœ‰ CDN åŠ é€Ÿï¼Œè®¿é—®å¿«

```bash
# 1. æ„å»ºå¹¶ä¸Šä¼ åç«¯
./åç«¯æ„å»ºä¸Šä¼ .sh

# 2. éƒ¨ç½²å‰ç«¯åˆ° Vercel
./å‰ç«¯éƒ¨ç½².sh
# é€‰æ‹© 1) Vercel
```

**ç»“æœ**ï¼š
- åç«¯ï¼š`http://8.137.52.203:8000`
- å‰ç«¯ï¼š`https://your-app.vercel.app`

---

### æ–¹å¼ 2ï¼šå‰åç«¯éƒ½åœ¨åŒä¸€æœåŠ¡å™¨

**ä¼˜ç‚¹**ï¼šç»Ÿä¸€ç®¡ç†ï¼Œæ— éœ€å¤–éƒ¨æœåŠ¡

```bash
# 1. æœ¬åœ°æ„å»ºæ‰€æœ‰å†…å®¹
./å®Œæ•´æ„å»ºä¸Šä¼ .sh

# 2. æœåŠ¡å™¨ä¸Šå¯åŠ¨
ssh root@8.137.52.203
cd /root
tar -xzf /tmp/battle-configs.tar.gz
./æœåŠ¡å™¨å¯åŠ¨.sh
```

**ç»“æœ**ï¼š
- åç«¯ï¼š`http://8.137.52.203:8000`
- å‰ç«¯ï¼š`http://8.137.52.203`

---

## âš¡ å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èæ–¹å¼ 1ï¼‰

### æ­¥éª¤ 1ï¼šæ„å»ºåç«¯

```bash
cd /Users/b022mc/project/battle
./åç«¯æ„å»ºä¸Šä¼ .sh
```

**è¿™ä¸ªè„šæœ¬åšä»€ä¹ˆ**ï¼š
1. åœ¨æœ¬åœ°æ„å»º Docker é•œåƒ
2. ä¿å­˜é•œåƒä¸º tar æ–‡ä»¶
3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
4. SSH åˆ°æœåŠ¡å™¨åŠ è½½é•œåƒå¹¶å¯åŠ¨å®¹å™¨

**è€—æ—¶**ï¼šçº¦ 3-5 åˆ†é’Ÿï¼ˆå–å†³äºç½‘é€Ÿï¼‰

### æ­¥éª¤ 2ï¼šéƒ¨ç½²å‰ç«¯

```bash
./å‰ç«¯éƒ¨ç½².sh
```

**è¿™ä¸ªè„šæœ¬åšä»€ä¹ˆ**ï¼š
1. æ£€æŸ¥ç¯å¢ƒå˜é‡
2. å®‰è£…ä¾èµ–
3. æ„å»º web-build/
4. éƒ¨ç½²åˆ° Vercelï¼ˆæˆ–å…¶ä»–å¹³å°ï¼‰

**è€—æ—¶**ï¼šçº¦ 2-3 åˆ†é’Ÿ

---

## ğŸ”§ è„šæœ¬è¯¦è§£

### åç«¯æ„å»ºä¸Šä¼ .sh

**å·¥ä½œæµç¨‹**ï¼š
```
æœ¬åœ°æ„å»ºé•œåƒ â†’ ä¿å­˜ä¸º tar â†’ ä¸Šä¼ åˆ°æœåŠ¡å™¨ â†’ åŠ è½½é•œåƒ â†’ å¯åŠ¨å®¹å™¨
```

**ä¼˜ç‚¹**ï¼š
- æœ¬åœ°æ„å»ºï¼Œé€Ÿåº¦å¿«
- æœåŠ¡å™¨æ— éœ€å®‰è£… Go ç¯å¢ƒ
- é•œåƒå¯å¤ç”¨

### å‰ç«¯éƒ¨ç½².sh

**æ”¯æŒä¸‰ç§éƒ¨ç½²æ–¹å¼**ï¼š
1. **Vercel** - å…è´¹ CDNï¼Œè‡ªåŠ¨ HTTPS
2. **Netlify** - å…è´¹é™æ€æ‰˜ç®¡
3. **è‡ªå»º Nginx** - éƒ¨ç½²åˆ°åŒä¸€æœåŠ¡å™¨

### å®Œæ•´æ„å»ºä¸Šä¼ .sh

**ä¸€æ¬¡æ€§æ„å»ºæ‰€æœ‰å†…å®¹**ï¼š
- åç«¯ Docker é•œåƒ
- å‰ç«¯ web-build
- é…ç½®æ–‡ä»¶
- éƒ¨ç½²è„šæœ¬

**é€‚ç”¨åœºæ™¯**ï¼šæƒ³æŠŠå‰åç«¯éƒ½æ”¾æœåŠ¡å™¨ä¸Š

### æœåŠ¡å™¨å¯åŠ¨.sh

**è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼š
- åŠ è½½ Docker é•œåƒ
- å¯åŠ¨åç«¯å®¹å™¨
- éƒ¨ç½²å‰ç«¯åˆ° Nginx
- é…ç½®é˜²ç«å¢™

---

## ğŸ“ å‰ç«¯ç¯å¢ƒå˜é‡

å·²é…ç½®ï¼š`battle-reusables/.env.production`

```bash
EXPO_PUBLIC_DEV_API_URL=http://8.137.52.203:8000
EXPO_PUBLIC_API_HOST=8.137.52.203
EXPO_PUBLIC_BYPASS_PROXY=true
```

---

## âš ï¸ éƒ¨ç½²å‰æ£€æŸ¥

### æœ¬åœ°ç¯å¢ƒ

- [ ] å·²å®‰è£… Docker
- [ ] å·²å®‰è£… Node.js (v18+)
- [ ] å·²é…ç½® SSH å…å¯†ç™»å½•ï¼ˆæ¨èï¼‰

### æœåŠ¡å™¨

- [ ] å·²å®‰è£… Dockerï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£…ï¼‰
- [ ] äº‘æœåŠ¡å™¨å®‰å…¨ç»„å·²å¼€æ”¾ **8000 ç«¯å£**
- [ ] å¦‚æœéƒ¨ç½²å‰ç«¯åˆ°æœåŠ¡å™¨ï¼Œå¼€æ”¾ **80 ç«¯å£**

### é…ç½®æ–‡ä»¶

- [ ] `battle-tiles/configs/config.yaml` å­˜åœ¨ä¸”æ­£ç¡®
- [ ] æ•°æ®åº“è¿æ¥ä¿¡æ¯æ­£ç¡®
- [ ] Redis è¿æ¥ä¿¡æ¯æ­£ç¡®

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ›´æ–°åç«¯

```bash
# é‡æ–°æ„å»ºä¸Šä¼ 
./åç«¯æ„å»ºä¸Šä¼ .sh
```

### æ›´æ–°å‰ç«¯

```bash
# é‡æ–°æ„å»ºéƒ¨ç½²
./å‰ç«¯éƒ¨ç½².sh
```

### åŒæ—¶æ›´æ–°

```bash
./å®Œæ•´æ„å»ºä¸Šä¼ .sh
ssh root@8.137.52.203 './æœåŠ¡å™¨å¯åŠ¨.sh'
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### åç«¯é•œåƒæ„å»ºå¤±è´¥

**æ£€æŸ¥**ï¼š
- Docker æ˜¯å¦è¿è¡Œï¼š`docker ps`
- Dockerfile è¯­æ³•æ˜¯å¦æ­£ç¡®
- ç½‘ç»œæ˜¯å¦æ­£å¸¸ï¼ˆéœ€è¦ä¸‹è½½ Go ä¾èµ–ï¼‰

**è§£å†³**ï¼š
```bash
cd battle-tiles
docker build -t battle-tiles:latest . --no-cache
```

### å‰ç«¯æ„å»ºå¤±è´¥

**æ£€æŸ¥**ï¼š
- Node.js ç‰ˆæœ¬ï¼š`node --version`ï¼ˆæ¨è v18+ï¼‰
- ä¾èµ–å®‰è£…ï¼š`cd battle-reusables && npm install`

**è§£å†³**ï¼š
```bash
cd battle-reusables
rm -rf node_modules package-lock.json
npm install
npm run build:web
```

### é•œåƒä¸Šä¼ å¤±è´¥

**æ£€æŸ¥**ï¼š
- SSH è¿æ¥ï¼š`ssh root@8.137.52.203`
- ç£ç›˜ç©ºé—´ï¼š`ssh root@8.137.52.203 'df -h'`

**è§£å†³**ï¼š
- å‹ç¼©é•œåƒï¼š`docker save battle-tiles:latest | gzip > battle-tiles.tar.gz`
- åˆ†æ®µä¸Šä¼ ï¼šä½¿ç”¨ rsync æ›¿ä»£ scp

### å®¹å™¨å¯åŠ¨å¤±è´¥

**æ£€æŸ¥æ—¥å¿—**ï¼š
```bash
ssh root@8.137.52.203 'docker logs battle-tiles'
```

**å¸¸è§é—®é¢˜**ï¼š
1. ç«¯å£è¢«å ç”¨ï¼š`lsof -i :8000`
2. é…ç½®æ–‡ä»¶é”™è¯¯ï¼šæ£€æŸ¥ config.yaml
3. æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

---

## ğŸŒ è®¿é—®åœ°å€

### æ–¹å¼ 1 éƒ¨ç½²å

- **åç«¯ API**: http://8.137.52.203:8000
- **å‰ç«¯åº”ç”¨**: https://your-app.vercel.app

### æ–¹å¼ 2 éƒ¨ç½²å

- **åç«¯ API**: http://8.137.52.203:8000
- **å‰ç«¯åº”ç”¨**: http://8.137.52.203

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### åç«¯

```bash
# æŸ¥çœ‹æ—¥å¿—
ssh root@8.137.52.203 'docker logs -f battle-tiles'

# é‡å¯
ssh root@8.137.52.203 'docker restart battle-tiles'

# åœæ­¢
ssh root@8.137.52.203 'docker stop battle-tiles'

# æŸ¥çœ‹çŠ¶æ€
ssh root@8.137.52.203 'docker ps | grep battle'
```

### å‰ç«¯ï¼ˆå¦‚æœéƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼‰

```bash
# æŸ¥çœ‹ Nginx æ—¥å¿—
ssh root@8.137.52.203 'tail -f /var/log/nginx/access.log'

# é‡å¯ Nginx
ssh root@8.137.52.203 'systemctl restart nginx'

# æµ‹è¯•é…ç½®
ssh root@8.137.52.203 'nginx -t'
```

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. é…ç½® SSH å…å¯†ç™»å½•

```bash
# ç”Ÿæˆå¯†é’¥
ssh-keygen -t rsa

# å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨
ssh-copy-id root@8.137.52.203
```

### 2. ä½¿ç”¨ Docker é•œåƒä»“åº“

å¦‚æœé¢‘ç¹éƒ¨ç½²ï¼Œå¯ä»¥æ¨é€åˆ° Docker Hubï¼š

```bash
# ç™»å½•
docker login

# æ ‡è®°é•œåƒ
docker tag battle-tiles:latest username/battle-tiles:latest

# æ¨é€
docker push username/battle-tiles:latest

# æœåŠ¡å™¨ç«¯æ‹‰å–
ssh root@8.137.52.203 'docker pull username/battle-tiles:latest'
```

### 3. å‰ç«¯ä½¿ç”¨ CDN

å¦‚æœéƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œå»ºè®®é…ç½® CDN åŠ é€Ÿé™æ€èµ„æºã€‚

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- **é•œåƒæ„å»ºé—®é¢˜**ï¼šæ£€æŸ¥ Dockerfile å’Œ Docker æ—¥å¿—
- **ç½‘ç»œä¸Šä¼ é—®é¢˜**ï¼šè€ƒè™‘ä½¿ç”¨ rsync æˆ–å‹ç¼©ä¼ è¾“
- **æœåŠ¡å™¨é—®é¢˜**ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œå®‰å…¨ç»„é…ç½®
- **å‰ç«¯è®¿é—®é—®é¢˜**ï¼šæ£€æŸ¥ CORS å’Œ API åœ°å€é…ç½®
