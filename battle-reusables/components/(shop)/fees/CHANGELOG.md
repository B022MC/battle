# 费用设置页面重构说明

## 📅 更新时间
2025-11-20

## 🔄 变更内容

### 旧版本问题
1. **界面复杂臃肿**：包含了过多的功能模块，用户体验差
2. **与后端API不一致**：部分调用方式与新后端设计不符
3. **缺少权限控制**：没有细粒度的权限管理
4. **交互不友好**：缺少加载状态、刷新功能等

### 新版本改进

#### 1. 简化界面设计
- **分运费设置**：使用开关组件，直观显示开启/关闭状态
- **推送配额功能**：已废弃移除
  - 新版本不再使用机器人推送系统
  - 仅在有历史数据时显示只读信息
  - 移除所有设置推送配额的功能
- **费用规则显示**：只读展示JSON配置，提示联系技术人员修改

#### 2. 对齐后端API
使用现有的后端API：
- `POST /shops/fees/get` - 查询店铺设置
- `POST /shops/sharefee/set` - 设置分运费
- ~~`POST /shops/pushcredit/set`~~ - 推送额度（已废弃，不再使用）

#### 3. 完善的权限控制
- `shop:fees:view` - 查看费用设置
- `shop:fees:update` - 更新费用设置

#### 4. 改进的用户体验
- ✅ 加载状态显示
- ✅ 下拉刷新功能
- ✅ 操作反馈（Toast提示）
- ✅ 禁用状态管理
- ✅ 输入验证

## 📁 文件变更

### 保留文件
- `fees-view.old.tsx` - 旧版本备份（可删除）

### 新文件
- `fees-view.tsx` - 重构后的费用设置页面

## 🎨 UI 设计

### 页面布局
```
┌─────────────────────────────────┐
│  店铺费用设置                    │
│  [店铺号输入] [查询按钮]         │
└─────────────────────────────────┘
┌─────────────────────────────────┐
│  📦 分运费                       │
│  [说明文字]            [开关]   │
└─────────────────────────────────┘
┌─────────────────────────────────┐ (仅有历史数据时显示)
│  🚫 推送配额（历史数据）         │
│  ⚠️ 此功能已废弃                │
└─────────────────────────────────┘
┌─────────────────────────────────┐
│  ⚙️ 费用规则配置（只读）         │
│  [JSON显示区域]                  │
└─────────────────────────────────┘
```

## 🔧 功能对比

| 功能 | 旧版本 | 新版本 |
|------|--------|--------|
| 分运费设置 | 两个按钮（开启/关闭） | Switch 开关 ✨ |
| 推送配额 | 输入+按钮 | **已废弃**（只读显示历史数据）🚫 |
| 费用规则 | 复杂表单+JSON模式切换 | 只读显示（简化）✨ |
| 费用结算 | 完整功能 | 移除（建议单独页面）📦 |
| 权限控制 | 无 | PermissionGate ✅ |
| 刷新功能 | 无 | 下拉刷新 ✅ |
| 加载状态 | 简单 | 完善 ✅ |

## 💡 设计理念

### 1. 关注点分离
- **简单功能**：直接在费用设置页面操作（分运费开关）
- **废弃功能**：机器人推送配额（新版本不再使用）
- **复杂功能**：移至独立页面（费用规则配置、结算分析）

### 2. 用户友好
- 直观的开关控件
- 清晰的状态反馈
- 实时的操作提示

### 3. 权限安全
- 查看权限：`shop:fees:view`
- 修改权限：`shop:fees:update`
- 细粒度控制每个操作

## 📝 使用说明

### 基本操作
1. 输入店铺号
2. 点击"查询"加载设置
3. 切换分运费开关
4. 查看费用规则配置（只读）
5. 如有历史推送配额数据会自动显示（只读，已废弃）

### 权限要求
- 查看设置：需要 `shop:fees:view` 权限
- 修改设置：需要 `shop:fees:update` 权限

## 🚀 下一步优化建议

1. **费用规则编辑器**：创建独立页面用于配置复杂的费用规则
2. **历史记录**：显示费用设置的修改历史
3. **批量操作**：支持同时设置多个店铺
4. **预览功能**：在保存前预览费用计算结果
5. **清理后端**：考虑移除 `push_credit` 相关的后端代码和数据库字段（与产品确认后）

## 📞 反馈

如有问题或建议，请联系开发团队。
